YUI.add("moodle-atto_kalturamedia-button",function(e,t){var n="atto_kalturamedia",r={URLINPUT:"atto_kalturamedia_urlentry",NAMEINPUT:"atto_kalturamedia_nameentry"},i={URLINPUT:"."+r.URLINPUT,NAMEINPUT:"."+r.NAMEINPUT};e.namespace("M.atto_kalturamedia").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_currentSelection:null,embedWindow:null,initializer:function(){this.addButton({icon:"icon",iconComponent:n,callback:this._kalturamedia})},_kalturamedia:function(){this._currentSelection=this.get("host").getSelection();if(this._currentSelection===!1)return;var e=1200,t=700,r=window.screenLeft!=undefined?window.screenLeft:screen.left,i=window.screenTop!=undefined?window.screenTop:screen.top,s=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,o=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,u=s/2-e/2+r,a=o/2-t/2+i,f=window.open(this._getIframeURL(),M.util.get_string("browse_and_embed",n),"scrollbars=no, width="+e+", height="+t+", top="+a+", left="+u);window.buttonJs=this,window.focus&&f.focus(),this.embedWindow=f},_getIframeURL:function(){var t=e.mix({elementid:this.get("host").get("elementid"),contextid:this.get("contextid"),height:"600px",width:"1112px"},this.get("area"));return M.cfg.wwwroot+"/lib/editor/atto/plugins/kalturamedia/ltibrowse_container.php?"+e.QueryString.stringify(t)},_getCourseId:function(){var e,t=document.getElementsByTagName("body")[0].className,n=t.split(" "),r;for(r in n)if(n[r].indexOf("course-")>-1){var i=n[r].split("-");e=i[1]}return e},_replaceKafUriWithToken:function(e,t,n){return e=this._removeProtocolFromUrl(e),t=this._removeProtocolFromUrl(t),e=this._removeTrailingSlash(e),t=this._removeTrailingSlash(t),e.replace(t,n)},_removeProtocolFromUrl:function(e){return e.replace(/^https?:\/\//,"")},_removeTrailingSlash:function(e){return e.replace(/\/$/,"")},embedItem:function(e,t){var n={},r,i;for(r in t){var s=r.split("-");s[0]=="embedinfo"&&(n[s[1]]=t[r])}var o=this.get("kalturauritoken"),u=this.get("kafuri"),a=n.url,f=this._replaceKafUriWithToken(a,u,o),l=document.createElement("a");l.href=a,f+=l.search;var c='<a href="http://'+f+'">tinymce-kalturamedia-embed||'+n.title+"||"+n.width+"||"+n.height+"</a>";i=this.get("host"),i.setSelection(this._currentSelection),i.insertContentAtFocusPoint(c),this.markUpdated(),this.embedWindow.close()}},{ATTRS:{contextid:{value:null},kalturauritoken:{value:null},kafuri:{value:null}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
